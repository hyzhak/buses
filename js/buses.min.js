!function(a,b){"use strict";function c(){if(!d.READY){d.event.determineEventTypes();for(var a in d.gestures)d.gestures.hasOwnProperty(a)&&d.detection.register(d.gestures[a]);d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0}}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=document,d.plugins={},d.READY=!1,d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.addEventListener(c[d],b,!1);return this},off:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.removeEventListener(c[d],b,!1);return this},trigger:function(a,b){var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){for(var d=b.split(" "),e=0;e<d.length;e++)a.addEventListener(d[e],c,!1)},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){(j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which)&&(f=!0),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),k||null===e?e=i:i=e,c.call(d.detection,h.collectEventData(a,b,i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:[{identifier:1,pageX:a.pageX,pageY:a.pageY,target:a.target}]},collectEventData:function(a,b,c){var e=this.getTouchList(c,b),f=d.POINTER_TOUCH;return(c.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,c))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(e),timeStamp:(new Date).getTime(),target:c.target,touches:e,eventType:b,pointerType:f,srcEvent:c,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return Object.keys(a.pointers).sort().forEach(function(c){b.push(a.pointers[c])}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c={};return c[d.POINTER_MOUSE]=b.pointerType==b.MSPOINTER_TYPE_MOUSE||b.pointerType==d.POINTER_MOUSE,c[d.POINTER_TOUCH]=b.pointerType==b.MSPOINTER_TYPE_TOUCH||b.pointerType==d.POINTER_TOUCH,c[d.POINTER_PEN]=b.pointerType==b.MSPOINTER_TYPE_PEN||b.pointerType==d.POINTER_PEN,c[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){for(var b=[],c=[],d=0,e=a.length;e>d;d++)b.push(a[d].pageX),c.push(a[d].pageY);return{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){var c,d=["webkit","khtml","moz","ms","o",""];if(b&&a.style){for(var e=0;e<d.length;e++)for(var f in b)b.hasOwnProperty(f)&&(c=f,d[e]&&(c=d[e]+c.substring(0,1).toUpperCase()+c.substring(1)),a.style[c]=b[f]);"none"==b.userSelect&&(a.onselectstart=function(){return!1})}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);for(var b=this.current.inst.options,c=0,e=this.gestures.length;e>c;c++){var f=this.gestures[c];if(!this.stopped&&b[f.name]!==!1&&f.handler.call(f,a,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;if(b&&(a.touches.length!=b.touches.length||a.touches===b.touches)){b.touches=[];for(var c=0,e=a.touches.length;e>c;c++)b.touches.push(d.utils.extend({},a.touches[c]))}var f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),direction:d.utils.getDirection(b.center,a.center),scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures=d.gestures||{},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),(!e||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;d.detection.current.name=this.name,(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var c=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&c!==a.direction&&(a.direction=d.utils.isVertical(c)?a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?(a.stopDetect(),void 0):(b.options.prevent_default&&a.preventDefault(),a.eventType==d.EVENT_START&&b.trigger(this.name,a),void 0)}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=d:(a.Hammer=d,"function"==typeof a.define&&a.define.amd&&a.define("hammer",[],function(){return d}))}(this);var hmTouchevents=angular.module("hmTouchevents",[]),hmGestures=["hmHold:hold","hmTap:tap","hmDoubletap:doubletap","hmDrag:drag","hmDragstart:dragstart","hmDragend:dragend","hmDragup:dragup","hmDragdown:dragdown","hmDragleft:dragleft","hmDragright:dragright","hmSwipe:swipe","hmSwipeup:swipeup","hmSwipedown:swipedown","hmSwipeleft:swipeleft","hmSwiperight:swiperight","hmTransformstart:transformstart","hmTransform:transform","hmTransformend:transformend","hmRotate:rotate","hmPinch:pinch","hmPinchin:pinchin","hmPinchout:pinchout","hmTouch:touch","hmRelease:release"];angular.forEach(hmGestures,function(a){var b=a.split(":"),c=b[0],d=b[1];hmTouchevents.directive(c,["$parse",function(a){return{scope:!0,link:function(b,e,f){var g,h;return g=a(f[c]),h=a(f.hmOptions)(b,{}),b.hammer=h&&h.group?b.hammer||Hammer(e[0],h):Hammer(e[0],h),b.hammer.on(d,function(a){return b.$apply(function(){return g(b,{$event:a})})})}}}])});var leafletDirective=angular.module("leaflet-directive",[]);leafletDirective.directive("leaflet",["$http","$log","$parse","$rootScope",function(a,b,c,d){var e={maxZoom:14,minZoom:1,doubleClickZoom:!0,scrollWheelZoom:!0,tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-icon@2x.png",size:[25,41],anchor:[12,40],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.5.1/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:10}},f=L.Icon.extend({options:{iconUrl:e.icon.url,iconRetinaUrl:e.icon.retinaUrl,iconSize:e.icon.size,iconAnchor:e.icon.anchor,popupAnchor:e.icon.popup,shadowUrl:e.icon.shadow.url,shadowRetinaUrl:e.icon.shadow.retinaUrl,shadowSize:e.icon.shadow.size,shadowAnchor:e.icon.shadow.anchor}}),g={AwesomeMarkersPlugin:{isLoaded:function(){return void 0!==L.AwesomeMarkers?void 0!==L.AwesomeMarkers.Icon:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,c){return this.isLoaded?this.is(a)&&this.is(c)?a.options.icon===c.options.icon&&a.options.iconColor===c.options.iconColor&&a.options.color===c.options.color&&a.options.iconSize[0]===c.options.iconSize[0]&&a.options.iconSize[1]===c.options.iconSize[1]&&a.options.iconAnchor[0]===c.options.iconAnchor[0]&&a.options.iconAnchor[1]===c.options.iconAnchor[1]&&a.options.popupAnchor[0]===c.options.popupAnchor[0]&&a.options.popupAnchor[1]===c.options.popupAnchor[1]&&a.options.shadowAnchor[0]===c.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===c.options.shadowAnchor[1]&&a.options.shadowSize[0]===c.options.shadowSize[0]&&a.options.shadowSize[1]===c.options.shadowSize[1]:!1:(b.error("[AngularJS - Leaflet] AwesomeMarkers Plugin not Loaded"),!1)}},MarkerClusterPlugin:{isLoaded:function(){return void 0!==L.MarkerClusterGroup},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return void 0!==L.Google},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.html===b.options.html&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]:!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.iconUrl===b.options.iconUrl&&a.options.iconRetinaUrl===b.options.iconRetinaUrl&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.shadowUrl===b.options.shadowUrl&&a.options.shadowRetinaUrl===b.options.shadowRetinaUrl&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]:!1}}}},h='Add testing="testing" to <leaflet> tag to inspect this object';return{restrict:"E",replace:!0,transclude:!0,scope:{center:"=center",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",defaults:"=defaults",paths:"=paths",tiles:"=tiles",events:"=events",layers:"=layers",customControls:"=customControls"},template:'<div class="angular-leaflet-map"></div>',link:function(a,i,j){function k(){var b=a.$root.$$phase;return!("$apply"===b||"$digest"===b)}function l(b){k()?a.$apply(b):a.$eval(b)}function m(){function a(a){return function(b){var c="leafletDirectiveMap."+a;l(function(){d.$broadcast(c,{leafletEvent:b})})}}for(var b=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"],c=0;c<b.length;c++){var e=b[c];M.on(e,a(e),{eventName:e})}}function n(){if("object"!=typeof a.events)return!1;for(var b in a.events)M.on(b,a.events[b])}function o(){if(void 0===a.layers||null===a.layers)v();else{if(void 0===a.layers.baselayers||null===a.layers.baselayers||"object"!=typeof a.layers.baselayers)return b.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),a.leaflet.layers=j.testing?N:h,void 0;if(Object.keys(a.layers.baselayers).length<=0)return b.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),a.leaflet.layers=j.testing?N:h,void 0;N={},N.baselayers={},N.controls={},N.controls.layers=(new L.control.layers).addTo(M);var c=!1;for(var d in a.layers.baselayers){var e=p(a.layers.baselayers[d]);null!==e&&(N.baselayers[d]=e,a.layers.baselayers[d].top===!0&&(M.addLayer(N.baselayers[d]),c=!0),N.controls.layers.addBaseLayer(N.baselayers[d],a.layers.baselayers[d].name))}!c&&Object.keys(N.baselayers).length>0&&M.addLayer(N.baselayers[Object.keys(a.layers.baselayers)[0]]),N.overlays={};for(d in a.layers.overlays){var f=p(a.layers.overlays[d]);null!==f&&(N.overlays[d]=f,a.layers.overlays[d].visible===!0&&M.addLayer(N.overlays[d]),N.controls.layers.addOverlay(N.overlays[d],a.layers.overlays[d].name))}a.$watch("layers.baselayers",function(c){var d=!1;for(var e in N.baselayers)void 0===c[e]&&(N.controls.layers.removeLayer(N.baselayers[e]),M.hasLayer(N.baselayers[e])&&M.removeLayer(N.baselayers[e]),delete N.baselayers[e],d=!0);for(var f in c)if(void 0===N.baselayers[f]){var g=p(c[f]);null!==g&&(N.baselayers[f]=g,c[f].top===!0&&M.addLayer(N.baselayers[f]),N.controls.layers.addBaseLayer(N.baselayers[f],c[f].name))}if(Object.keys(N.baselayers).length<=0)b.error("[AngularJS - Leaflet] At least one baselayer has to be defined");else{var h=!1;for(var i in N.baselayers)if(M.hasLayer(N.baselayers[i])){h=!0;break}h||M.addLayer(N.baselayers[Object.keys(a.layers.baselayers)[0]])}},!0),a.$watch("layers.overlays",function(a){for(var b in N.overlays)void 0===a[b]&&(N.controls.layers.removeLayer(N.overlays[b]),M.hasLayer(N.overlays[b])&&M.removeLayer(N.overlays[b]),delete N.overlays[b]);for(var c in a)if(void 0===N.overlays[c]){var d=p(a[c]);null!==d&&(N.overlays[c]=d,N.controls.layers.addOverlay(N.overlays[c],a[c].name),a[c].visible===!0&&M.addLayer(N.overlays[c]))}},!0)}a.leaflet.layers=j.testing?N:h}function p(a){if(void 0===a.type||null===a.type||"string"!=typeof a.type)return b.error("[AngularJS - Leaflet] A base layer must have a type"),null;if("xyz"!==a.type&&"wms"!==a.type&&"group"!==a.type&&"markercluster"!==a.type&&"google"!==a.type)return b.error('[AngularJS - Leaflet] A layer must have a valid type: "xyz, wms, group"'),null;if(!("xyz"!==a.type&&"wms"!==a.type||void 0!==a.url&&null!==a.url&&"string"==typeof a.url))return b.error("[AngularJS - Leaflet] A base layer must have an url"),null;if(void 0===a.name||null===a.name||"string"!=typeof a.name)return b.error("[AngularJS - Leaflet] A base layer must have a name"),null;(void 0===a.layerParams||null===a.layerParams||"object"!=typeof a.layerParams)&&(a.layerParams={}),(void 0===a.layerOptions||null===a.layerOptions||"object"!=typeof a.layerOptions)&&(a.layerOptions={});var c=null;for(var d in a.layerParams)a.layerOptions[d]=a.layerParams[d];switch(a.type){case"xyz":c=q(a.url,a.layerOptions);break;case"wms":c=r(a.url,a.layerOptions);break;case"group":c=s();break;case"markercluster":c=t(a.layerOptions);break;case"google":c=u(a.layerOptions);break;default:c=null}return c}function q(a,b){var c=L.tileLayer(a,b);return c}function r(a,b){var c=L.tileLayer.wms(a,b);return c}function s(){var a=L.layerGroup();return a}function t(a){if(g.MarkerClusterPlugin.isLoaded()){var b=new L.MarkerClusterGroup(a);return b}return null}function u(a){if(g.GoogleLayerPlugin.isLoaded()){var b=new L.Google(a);return b}return null}function v(){var b,c;if(a.leaflet.tileLayer=j.defaults&&a.defaults&&a.defaults.tileLayer?a.defaults.tileLayer:e.tileLayer,a.defaults&&a.defaults.tileLayerOptions)for(c in a.defaults.tileLayerOptions)e.tileLayerOptions[c]=a.defaults.tileLayerOptions[c];if(j.tiles){if(a.tiles&&a.tiles.url&&(a.leaflet.tileLayer=a.tiles.url),a.tiles&&a.tiles.options)for(c in a.tiles.options)e.tileLayerOptions[c]=a.tiles.options[c];a.$watch("tiles.url",function(a){a&&b.setUrl(a)})}b=L.tileLayer(a.leaflet.tileLayer,e.tileLayerOptions),b.addTo(M),a.leaflet.tileLayerObj=j.testing?b:h}function w(){if(a.legend)if(a.legend.colors&&a.legend.labels&&a.legend.colors.length===a.legend.labels.length){var c=a.legend.position||"bottomright",d=L.control({position:c});d.onAdd=function(){for(var b=L.DomUtil.create("div","info legend"),c=0;c<a.legend.colors.length;c++)b.innerHTML+='<i style="background:'+a.legend.colors[c]+'"></i> '+a.legend.labels[c]+"<br />";return b},d.addTo(M)}else b.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}function x(){a.maxBounds&&a.maxBounds.southWest&&a.maxBounds.southWest.lat&&a.maxBounds.southWest.lng&&a.maxBounds.northEast&&a.maxBounds.northEast.lat&&a.maxBounds.northEast.lng&&(M.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.maxBounds.southWest.lat,a.maxBounds.southWest.lng),new L.LatLng(a.maxBounds.northEast.lat,a.maxBounds.northEast.lng))),a.$watch("maxBounds",function(a){a.southWest&&a.northEast&&a.southWest.lat&&a.southWest.lng&&a.northEast.lat&&a.northEast.lng&&M.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.southWest.lat,a.southWest.lng),new L.LatLng(a.northEast.lat,a.northEast.lng)))}))}function y(a){if(a){var b=a.southWest,c=a.northEast;if(b&&c&&b.lat&&b.lng&&c.lat&&c.lng){var d=new L.LatLng(b.lat,b.lng),e=new L.LatLng(c.lat,c.lng);M.fitBounds(new L.LatLngBounds(d,e))}}}function z(){a.bounds&&a.$watch("bounds",function(a){y(a)})}function A(){if(!a.center)return b.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),M.setView([e.center.lat,e.center.lng],e.center.zoom),void 0;void 0!==a.center.lat&&null!==a.center.lat&&"number"==typeof a.center.lat&&void 0!==a.center.lng&&null!==a.center.lng&&"number"==typeof a.center.lng&&void 0!==a.center.zoom&&null!==a.center.zoom&&"number"==typeof a.center.zoom?M.setView([a.center.lat,a.center.lng],a.center.zoom):j.center.autoDiscover===!0?M.locate({setView:!0,maxZoom:a.leaflet.maxZoom}):(b.warn("[AngularJS - Leaflet] 'center' is incorrect"),M.setView([e.center.lat,e.center.lng],e.center.zoom));var d={lat:c("center.lat"),lng:c("center.lng"),zoom:c("center.zoom")};a.$watch("center",function(c,d){return c?(d&&(void 0!==c.lat&&null!==c.lat&&"number"==typeof c.lat&&void 0!==c.lng&&null!==c.lng&&"number"==typeof c.lng&&void 0!==c.zoom&&null!==c.zoom&&"number"==typeof c.zoom?void 0!==d.lat&&null!==d.lat&&"number"==typeof d.lat&&void 0!==d.lng&&null!==d.lng&&"number"==typeof d.lng&&void 0!==d.zoom&&null!==d.zoom&&"number"==typeof d.zoom?(c.lat!==d.lat||c.lng!==d.lng||c.zoom!==d.zoom)&&M.setView([c.lat,c.lng],c.zoom):M.setView([c.lat,c.lng],c.zoom):c.autoDiscover===!0&&d.autoDiscover!==!0?M.locate({setView:!0,maxZoom:a.leaflet.maxZoom}):(void 0===c.autoDiscover||null===c.autoDiscover)&&(b.warn("[AngularJS - Leaflet] 'center' is incorrect"),M.setView([e.center.lat,e.center.lng],e.center.zoom))),void 0):(b.warn("[AngularJS - Leaflet] 'center' have been removed?"),M.setView([e.center.lat,e.center.lng],e.center.zoom),void 0)},!0),M.on("moveend",function(){l(function(a){d&&(d.lat.assign(a,M.getCenter().lat),d.lng.assign(a,M.getCenter().lng),d.zoom.assign(a,M.getZoom()))})})}function B(){a.$watch("geojson",function(b){if(b&&(a.leaflet.geojson&&M.removeLayer(a.leaflet.geojson),b.hasOwnProperty("data"))){var c=a.geojson.resetStyleOnMouseout;a.leaflet.geojson=L.geoJson(a.geojson.data,{style:a.geojson.style,onEachFeature:function(e,f){f.on({mouseover:function(a){l(function(){b.selected=e,d.$broadcast("leafletDirectiveMap.geojsonMouseover",a)})},mouseout:function(e){c&&a.leaflet.geojson.resetStyle(e.target),l(function(){b.selected=void 0,d.$broadcast("leafletDirectiveMap.geojsonMouseout",e)})},click:function(a){l(function(){d.$broadcast("leafletDirectiveMap.geojsonClick",b.selected,a)})}})}}).addTo(M)}})}function C(){var b;a.marker&&(b=E("marker",a.marker,M),a.leaflet.marker=j.testing?b:h,b.on("click",function(){l(function(){d.$broadcast("leafletDirectiveMainMarkerClick")})}))}function D(){var b={};if(a.markers){for(var c in a.markers){var d=E("markers."+c,a.markers[c],M);null!==d&&(b[c]=d)}a.$watch("markers",function(c){for(var d in b)if(void 0===c[d]){if(b[d].closePopup(),void 0!==N&&null!==N&&void 0!==N.overlays)for(var e in N.overlays)N.overlays[e]instanceof L.LayerGroup&&N.overlays[e].hasLayer(b[d])&&N.overlays[e].removeLayer(b[d]);M.removeLayer(b[d]),delete b[d]}for(var f in c)if(void 0===b[f]){var g=E("markers."+f,a.markers[f],M);null!==g&&(b[f]=g)}},!0),a.leaflet.markers=j.testing?b:h}}function E(c,e,h){function i(a){return function(b){var f="leafletDirectiveMarker."+a,g=c.replace("markers.","");"click"===a?l(function(){d.$broadcast("leafletDirectiveMarkersClick",g)}):"dragend"===a&&(l(function(){e.lat=j.getLatLng().lat,e.lng=j.getLatLng().lng}),e.message&&e.focus===!0&&j.openPopup()),l(function(){d.$broadcast(f,{markerName:g,leafletEvent:b})})}}var j=F(e);if(void 0===e.layer)h.addLayer(j),e.focus===!0&&j.openPopup();else{if("string"!=typeof e.layer)return b.error("[AngularJS - Leaflet] A layername must be a string"),null;if(void 0===N.overlays[e.layer])return b.error("[AngularJS - Leaflet] You must use a name of an existing layer"),null;var k=N.overlays[e.layer];if(!(k instanceof L.LayerGroup))return b.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"'),null;k.addLayer(j),h.hasLayer(j)&&e.focus===!0&&j.openPopup()}for(var m=["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"],n=0;n<m.length;n++){var o=m[n];j.on(o,i(o),{eventName:o,scope_watch_name:c})}var p=a.$watch(c,function(a,c){if(!a){if(j.closePopup(),void 0!==N&&null!==N&&void 0!==N.overlays)for(var d in N.overlays)N.overlays[d]instanceof L.LayerGroup&&N.overlays[d].hasLayer(j)&&N.overlays[d].removeLayer(j);return h.removeLayer(j),p(),void 0}if(c){if(void 0===a.layer||null===a.layer||"string"!=typeof a.layer)void 0!==c.layer&&null!==c.layer&&"string"==typeof c.layer&&(void 0!==N.overlays[c.layer]&&N.overlays[c.layer].hasLayer(j)&&(N.overlays[c.layer].removeLayer(j),j.closePopup()),h.hasLayer(j)||h.addLayer(j));else if(void 0===c.layer||null===c.layer||c.layer!==a.layer)if("string"==typeof c.layer&&void 0!==N.overlays[c.layer]&&N.overlays[c.layer].hasLayer(j)&&N.overlays[c.layer].removeLayer(j),j.closePopup(),h.hasLayer(j)&&h.removeLayer(j),void 0!==N.overlays[a.layer]){var e=N.overlays[a.layer];e instanceof L.LayerGroup?(e.addLayer(j),h.hasLayer(j)&&a.focus===!0&&j.openPopup()):b.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"')}else b.error("[AngularJS - Leaflet] You must use a name of an existing layer");if(void 0===a.draggable||null===a.draggable||a.draggable!==!0?void 0!==c.draggable&&null!==c.draggable&&c.draggable===!0&&j.dragging.disable():(void 0===c.draggable||null===c.draggable||c.draggable!==!0)&&j.dragging.enable(),void 0===a.icon||null===a.icon||"object"!=typeof a.icon)void 0!==c.icon&&null!==c.icon&&"object"==typeof c.icon&&(j.setIcon(new f),j.closePopup(),j.unbindPopup(),void 0!==a.message&&null!==a.message&&"string"==typeof a.message&&""!==a.message&&j.bindPopup(a.message));else if(void 0===c.icon||null===c.icon||"object"!=typeof c.icon){var i=j.dragging.enabled();g.AwesomeMarkersPlugin.is(a.icon)?j.setIcon(a.icon):g.Leaflet.DivIcon.is(a.icon)||g.Leaflet.Icon.is(a.icon)?j.setIcon(a.icon):j.setIcon(new f(a.icon)),i&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==a.message&&null!==a.message&&"string"==typeof a.message&&""!==a.message&&j.bindPopup(a.message)}else if(g.AwesomeMarkersPlugin.is(a.icon)){if(!g.AwesomeMarkersPlugin.equal(a.icon,c.icon)){var k=j.dragging.enabled();j.setIcon(a.icon),k&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==a.message&&null!==a.message&&"string"==typeof a.message&&""!==a.message&&j.bindPopup(a.message)}}else if(g.Leaflet.DivIcon.is(a.icon)){if(!g.Leaflet.DivIcon.equal(a.icon,c.icon)){var l=j.dragging.enabled();j.setIcon(a.icon),l&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==a.message&&null!==a.message&&"string"==typeof a.message&&""!==a.message&&j.bindPopup(a.message)}}else if(g.Leaflet.Icon.is(a.icon)){if(!g.Leaflet.Icon.equal(a.icon,c.icon)){var m=j.dragging.enabled();j.setIcon(a.icon),m&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==a.message&&null!==a.message&&"string"==typeof a.message&&""!==a.message&&j.bindPopup(a.message)}}else if(JSON.stringify(a.icon)!==JSON.stringify(c.icon)){var n=j.dragging.enabled();j.setIcon(new f(a.icon)),n&&j.dragging.enable(),j.closePopup(),j.unbindPopup(),void 0!==a.message&&null!==a.message&&"string"==typeof a.message&&""!==a.message&&j.bindPopup(a.message)}if(void 0===a.message||null===a.message||"string"!=typeof a.message||""===a.message?void 0!==c.message&&null!==c.message&&"string"==typeof c.message&&""!==c.message&&(j.closePopup(),j.unbindPopup()):void 0===c.message||null===c.message||"string"!=typeof c.message||""===c.message?(j.bindPopup(a.message),a.focus===!0&&j.openPopup()):a.message!==c.message&&j.setPopupContent(a.message),void 0===a.focus||null===a.focus||a.focus!==!0?void 0!==c.focus&&null!==c.focus&&c.focus===!0&&j.closePopup():(void 0===c.focus||null===c.focus||c.focus!==!0)&&j.openPopup(),void 0===a.lat||null===a.lat||isNaN(a.lat)||"number"!=typeof a.lat||void 0===a.lng||null===a.lng||isNaN(a.lng)||"number"!=typeof a.lng){if(b.warn("There are problems with lat-lng data, please verify your marker model"),void 0!==N&&void 0!==N.overlays)for(var o in N.overlays)N.overlays[o]instanceof L.LayerGroup&&N.overlays[o].hasLayer(j)&&N.overlays[o].removeLayer(j);h.removeLayer(j)}else{var q=j.getLatLng();if(q.lat!==a.lat||q.lng!==a.lng){var r=!1;void 0!==a.layer&&null!==a.layer&&"string"==typeof a.layer&&g.MarkerClusterPlugin.is(N.overlays[a.layer])&&(N.overlays[a.layer].removeLayer(j),r=!0),j.setLatLng([a.lat,a.lng]),r&&N.overlays[a.layer].addLayer(j)}}}},!0);return j}function F(a){var b=null;b=a.icon?a.icon:new f;var c={icon:b,draggable:a.draggable?!0:!1};a.title&&(c.title=a.title);var d=new L.marker(a,c);return a.message&&d.bindPopup(a.message),d}function G(){var c={};
if(a.leaflet.paths=j.testing?c:h,a.paths){b.warn("[AngularJS - Leaflet] Creating polylines and adding them to the map will break the directive's scope's inspection in AngularJS Batarang");for(var d in a.paths)c[d]=H(d,a.paths[d],M);a.$watch("paths",function(a){for(var b in a)void 0===c[b]&&(c[b]=H(b,a[b],M));for(var d in c)void 0===a[d]&&delete c[d]},!0)}}function H(b,c,d){var f=new L.Polyline([],{weight:e.path.weight,color:e.path.color,opacity:e.path.opacity});if(void 0!==c.latlngs){var g=I(c.latlngs);f.setLatLngs(g)}void 0!==c.weight&&f.setStyle({weight:c.weight}),void 0!==c.color&&f.setStyle({color:c.color}),void 0!==c.opacity&&f.setStyle({opacity:c.opacity}),d.addLayer(f);var h=a.$watch("paths."+b,function(a,b){if(!a)return d.removeLayer(f),h(),void 0;if(b){if(void 0!==a.latlngs&&a.latlngs!==b.latlngs){var c=I(a.latlngs);f.setLatLngs(c)}void 0!==a.weight&&a.weight!==b.weight&&f.setStyle({weight:a.weight}),void 0!==a.color&&a.color!==b.color&&f.setStyle({color:a.color}),void 0!==a.opacity&&a.opacity!==b.opacity&&f.setStyle({opacity:a.opacity})}},!0);return f}function I(a){var b=a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)});return b}function J(){a.defaults&&a.defaults.zoomControlPosition&&M.zoomControl.setPosition(a.defaults.zoomControlPosition)}function K(){if(a.customControls)for(var b=0,c=a.customControls.length;c>b;b++)M.addControl(new a.customControls[b])}j.width&&i.css("width",j.width),j.height&&i.css("height",j.height),a.leaflet={},a.leaflet.maxZoom=j.defaults&&a.defaults&&a.defaults.maxZoom?parseInt(a.defaults.maxZoom,10):e.maxZoom,a.leaflet.minZoom=j.defaults&&a.defaults&&a.defaults.minZoom?parseInt(a.defaults.minZoom,10):e.minZoom,a.leaflet.doubleClickZoom=j.defaults&&a.defaults&&"boolean"==typeof a.defaults.doubleClickZoom?a.defaults.doubleClickZoom:e.doubleClickZoom,a.leaflet.scrollWheelZoom=j.defaults&&a.defaults&&"boolean"==typeof a.defaults.scrollWheelZoom?a.defaults.scrollWheelZoom:e.scrollWheelZoom;var M=new L.Map(i[0],{maxZoom:a.leaflet.maxZoom,minZoom:a.leaflet.minZoom,doubleClickZoom:a.leaflet.doubleClickZoom,scrollWheelZoom:a.leaflet.scrollWheelZoom}),N=null;M.setView([e.center.lat,e.center.lng],e.center.zoom),a.leaflet.map=j.testing?M:h,J(),K(),o(),A(),x(),z(),C(),D(),G(),w(),m(),n(),B(),a.$on("leafletDirectiveSetMap",function(a,b){var c=b.shift();M[c].apply(M,b)})}}}]),angular.module("ApiService",["ngResource"]).factory("Venue",function(a){"use strict";return a("api/v1/venues/:venueId.json",{},{query:{method:"GET",params:{venueId:"venues"},isArray:!0}})});var digiletme=angular.module("digiletme",["ngRoute","ApiService","leaflet-directive","FourSquare","Carousel","SmartIP","hmTouchevents","Location"]);angular.module("digiletme").constant("DEF_ZOOM",8),digiletme.config(["$locationProvider","$routeProvider","LocationProvider",function(a,b){"use strict";a.hashPrefix("!"),b.when("/location/:zoom?/:lat?/:lng?/:venueId?",{action:"location",template:""}).when("/venue/:venueId?",{action:"venue",template:"",resolve:{Location:"Location"}}).when("/photos/:venueId/:photoId",{action:"photo",templateUrl:"partials/photoPartial.html",controller:"PhotoCtrl"}).otherwise({redirectTo:"location/"})}]).constant("").run(["FourSquareClient",function(a){a.CLIENT_ID="2WYFEWX521WPPTCQ3MKLLEGAHOW3EHPGLF1H4KXDB5OCQYT5",a.CLIENT_SECRET="TJ0ORRJ4VPQFZHQ3USFLV2TVBYJRQ1O30ZY5RCNXL5SM23IF"}]),digiletme.controller("PhotosPreviewCarouselCtrl",["$scope",function(){}]),digiletme.controller("RoutingCtrl",["$scope","$rootScope","VenuesAPI","Location","$http","$resource","$q","$location","$timeout","$window",function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=0;b.$on("$routeChangeStart",function(a,c){if(document.body.style.overflowY="auto",k&&(j.scrollTo(0,k),k=0,i(function(){},100)),c)switch(c.action){case"venue":d.getLocation().then(function(a){h.path("location/"+a.zoom+"/"+a.lat+"/"+a.lng+"/"+c.params.venueId)});break;case"photo":b.$broadcast("selectPhoto",c.params.photoId),document.body.style.overflowY="hidden",k=j.scrollY;break;case"location":c.params.hasOwnProperty("lat")&&c.params.hasOwnProperty("lng")&&c.params.hasOwnProperty("zoom")&&d.setLocation(Number(c.params.lat),Number(c.params.lng),Number(c.params.zoom)),c.params.venueId&&b.$broadcast("selectVenue",c.params.venueId)}})}]),digiletme.controller("SearchResultCtrl",["$scope","$rootScope","VenuesAPI","Location","$http","$resource","$q","$location","$timeout","$window",function(a,b,c,d,e,f,g,h){"use strict";function i(a){var b=j(a);requestAnimFrame(b),l.inProgress=!1,l=b}function j(a){0>a&&(a=0);var b=function(){var c=window.scrollY-a,d=10;c>-d&&d>c||!b.inProgress?m=Math.round(a):(m=Math.round(window.scrollY-c/d),requestAnimFrame(b)),window.scrollTo(0,m)};return b.inProgress=!0,b}a.hasVenuesWithoutPhotos=!1,a.venuesWithoutPhotos={},a.venues={},a.waitForVenuesWithPhotos=!0,c.getLocalVenues().then(function(){a.waitForVenuesWithPhotos=!1}),b.$on("showVenue",function(b,c){a.venues[c.id]||(a.venues[c.id]=c)}),b.$on("hideVenue",function(b,c){a.venues[c.id]&&(a.venues[c.id]=null)}),b.$on("showVenueWithoutPhoto",function(b,c){a.venuesWithoutPhotos[c.id]||(a.venuesWithoutPhotos[c.id]=c,a.hasVenuesWithoutPhotos=!0)}),b.$on("hideVenueWithoutPhoto",function(b,c){a.venuesWithoutPhotos[c.id]&&(a.venuesWithoutPhotos[c.id]=null)}),a.concat4SQImg=function(a,b,c){if(!a.prefix||!a.suffix)return"";var d=a.prefix.substr(0,a.prefix.length-1),e="",f=a.suffix;return b&&c&&(e="/"+b+"x"+c),d+e+f},a.getDivStyleFor4SQImg=function(b,c,d){return{backgroundImage:"url('"+a.concat4SQImg(b,c,d)+"')"}},a.getPhotosOfVenue=function(){var a={},b={};return function(d){if(b[d.id]){var e=b[d.id];return d.visible=e.length>0,g.when(e)}return a[d.id]||(a[d.id]=c.getPhotosByVenueId(d.id).then(function(c){a[d.id]=null,b[d.id]=c;var e=c.length>0;return d.visible=e,c})),a[d.id]}}();var k=f("http://maps.googleapis.com/maps/api/geocode/json?latlng=:pos&language=en&sensor=false",{});a.getAddressOfVenue=function(){var a={};return function(b){return a[b.id]||(a[b.id]=b.location.city?(b.location.address?b.location.address+", ":"")+(b.location.city?b.location.city+", ":"")+(b.location.country?b.location.country:""):k.get({pos:b.location.lat+","+b.location.lng}).$promise.then(function(c){return c.results.length<=0?"unknown":(a[b.id]=c.results[0].formatted_address,a[b.id])})),a[b.id]}}(),a.$on("selectVenue",function(a,b){var c=document.querySelector("#venue-"+b),d=c.getBoundingClientRect(),e=d.top+window.scrollY-250;i(e)});var l={};window.addEventListener("scroll",function(){m!==window.scrollY&&(l.inProgress=!1)});var m;a.$on("selectMarkerOnMap",function(a,b){var c="venue/"+b;h.path(c)})}]),Hammer.plugins.fakeMultitouch&&Hammer.plugins.fakeMultitouch(),Hammer.plugins.showTouches&&Hammer.plugins.showTouches(),angular.module("Carousel",[]).directive("carousel",["$window","$timeout",function(a,b){"use strict";function c(a){g.indexOf(a)>=0||g.push(a)}function d(a){var b=g.indexOf(a);g.splice(b,1)}function e(a){h.indexOf(a)>=0||h.push(a)}function f(a){var b=h.indexOf(a);h.splice(b,1)}var g=[],h=[],i=8;return function j(){var a,b;for(a=0,b=g.length;b>a;a++)g[a].scrollLeft-=i;for(a=0,b=h.length;b>a;a++)h[a].scrollLeft+=i;requestAnimFrame(j)}(),{replace:!0,restrict:"E",template:'<div style="position: relative"><a href ng-mousedown="startGoLeft()" ng-mouseup="stopGoLeft()"><div class="carousel-left-arrow" ng-show="useScrollButtons"><span class="glyphicon glyphicon-chevron-left"></span></div></a><div class="photos-preview-carousel"><div class="photos-preview-carousel-collection" ng-controller="PhotosPreviewCarouselCtrl"><div ng-repeat="venueImage in images" class="photo-border"><div ng-style="getDivStyleFor4SQImg(venueImage, 100, 100)" class="photo-small-preview"><div class="actions"><a href="#!/photos/{{ venue.id }}/{{ venueImage.id }}" class="btn btn-primary btn-small"> <span class="glyphicon glyphicon-zoom-in"></span></a></div></div></div></div></div><a href ng-mousedown="startGoRight()" ng-mouseup="stopGoRight()"><div class="carousel-right-arrow" ng-show="useScrollButtons"><span class="glyphicon glyphicon-chevron-right"></span></div></a></div>',link:function(a,g,h){a.venue=a.$eval(h.venue);var i=a.$eval(h.data);i.then(function(h){a.useScrollButtons=!1,a.images=h,a.elementWidth=0,b(function(){if(!(a.images.length<=0)){var b=g[0].children[1].children[0],c=g[0].children[1].children[0].children[0],d=g[0].children[1].clientWidth,e=3,f=c.clientWidth+2*e,h=a.images.length*f;a.useScrollButtons=h>d?!0:!1,b.style.width=h+"px",a.elementWidth=f,a.scrollContainer=g[0].children[1]}},0),a.startGoLeft=function(){c(a.scrollContainer)},a.stopGoLeft=function(){d(a.scrollContainer)},a.startGoRight=function(){e(a.scrollContainer)},a.stopGoRight=function(){f(a.scrollContainer)}})}}}]);var FourSquareModule=angular.module("FourSquare",[]);FourSquareModule.factory("FourSquareClient",function(){function a(a){var b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return""+d+(9>=c?"0"+c:c)+(9>=b?"0"+b:b)}return{currentAPIDate:a(new Date),CLIENT_ID:null,CLIENT_SECRET:null}}),FourSquareModule.factory("FourSquarePhotos",["FourSquareClient","VenuesAPI","$q","$resource","$rootScope","$timeout",function(a,b,c,d){"use strict";function e(a,b,c){if(!a||!a.prefix||!a.suffix)return"";var d=a.prefix.substr(0,a.prefix.length-1),e="",f=a.suffix;return e=b&&c?"/"+b+"x"+c:"/original",d+e+f}var f={},g=!1,h=d("https://api.foursquare.com/v2/photos/:photoId?client_id=:clientId&client_secret=:clientSecret&v="+a.currentAPIDate,{clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET});return f.getPhotoUrlById=function(a,d,f,i){var j=b.getPhotoById(d);return j?c.when(e(j,f,i)):g?h.get({photoId:id}).$promise.then(function(a){return e(a.response.photo,f,i)},function(a){console.log("error",a)}):b.getPhotosByVenueId(a).then(function(a){for(var b=0,c=a.length;c>b;b++){var g=a[b];if(g.id===d)return e(g,f,i)}return null})},f}]),angular.module("Location",[]).factory("Location",["SmartIP","$q","$rootScope","$location","DEF_ZOOM",function(a,b,c,d,e){"use strict";var f,g={};return g.getLocation=function(){return f?b.when(f):g.requestMyLocation()},g.requestMyLocation=function(){return a.getUserLocation().then(function(a){return g.setLocation(a.lat,a.lng),a},function(a){return console.log(a),g.requestLocationFromGPS().then(function(a){var b=a.coords;return{lat:b.latitude,lng:b.longitude}})})},g.requestLocationFromGPS=function(){return function(){var a=b.defer();return navigator.geolocation.getCurrentPosition(function(b){var d=b.coords;g.setLocation(d.latitude,d.longitude),a.resolve(b),c.$digest()},function(b){console.log(b),a.reject(b)}),a.promise}}(),g.setLocation=function(a,b,g){f=f||{},g=Number(g||f.zoom||e),(f.lat!==a||f.lng!==b||f.zoom!==g)&&(f.lat=Number(a),f.lng=Number(b),f.zoom=g,c.$emit("updateUserLocation",f),d.path("location/"+g+"/"+a+"/"+b),d.replace())},g}]),digiletme.controller("MapCtrl",["VenuesAPI","Location","$scope","$rootScope","$timeout","$q","DEF_ZOOM",function(a,b,c,d,e,f,g){"use strict";function h(a){return n===a?!1:n?(n.focus=!1,!0):!0}function i(a){n=a}function j(){return b.getLocation().then(function(a){return a.hasOwnProperty("zoom")?c.center.zoom=a.zoom:q&&(q=!1,c.center.zoom=g),c.center.lat=a.lat,c.center.lng=a.lng,a})}function k(){c.waitForVenuesWithPhotos=!0,a.getVenuesWithPhotos()}function l(){j().then(function(){m=!0}),k()}c.center={},c.markers={};var m=!1;c.events={dblclick:function(a){console.log(a)},click:function(a){console.log(a)},zoomend:function(a){o(a.target.getBounds().getSouthWest(),a.target.getBounds().getNorthEast()),b.setLocation(c.center.lat,c.center.lng,c.center.zoom)},dragend:function(a){o(a.target.getBounds().getSouthWest(),a.target.getBounds().getNorthEast()),b.setLocation(c.center.lat,c.center.lng,c.center.zoom)},moveend:function(a){if(m){var d=a.target.getBounds().getSouthWest(),e=a.target.getBounds().getNorthEast();o(d,e),b.setLocation(.5*(d.lat+e.lat),.5*(d.lng+e.lng),c.center.zoom),m=!1}}},c.$on("leafletDirectiveMarkersClick",function(a,b){var e=c.markers[b];d.$broadcast("selectMarkerOnMap",b),h(e),i(e)});var n=null;d.$on("selectVenue",function(a,b){var d=c.markers[b];d&&h(d)&&(d.focus=!0,n=d,i(d))}),d.$on("updateBounds",function(){k()}),d.$on("showVenue",function(a,b){c.markers[b.id]||(c.markers[b.id]={lat:b.location.lat,lng:b.location.lng,message:b.name})}),d.$on("hideVenue",function(a,b){c.markers[b.id]&&delete c.markers[b.id]});var o=function(){var b,c,d;return function(f,g){b=f,c=g,d&&e.cancel(d),d=e(function(){a.updateBounds(b,c),d=null},2e3)}}(),p=!0;c.$on("$destroy",function(){console.log("destroy"),p=!1});var q=!0;c.myCustomControls=[];var r=L.Control.extend({options:{position:"bottomleft"},onAdd:function(a){var b="leaflet-control-my-location",c=L.DomUtil.create("div",b+" leaflet-bar");return this._map=a,this._zoomInButton=this._createButton("&gt;","My Location",b,c,this._findLocation,this),c},_findLocation:function(){b.requestMyLocation().then(function(a){c.center.lat=a.lat,c.center.lng=a.lng,c.center.zoom=a.zoom})},_createButton:function(a,b,c,d,e,f){var g=L.DomUtil.create("a",c,d);g.innerHTML=a,g.href="#",g.title=b;var h=L.DomEvent.stopPropagation;return L.DomEvent.on(g,"click",h).on(g,"mousedown",h).on(g,"dblclick",h).on(g,"click",L.DomEvent.preventDefault).on(g,"click",e,f),g},_updateDisabled:function(){var a=this._map,b="leaflet-control-zoom-disabled";L.DomUtil.removeClass(this._zoomInButton,b),L.DomUtil.removeClass(this._zoomOutButton,b),a._zoom===a.getMinZoom()&&L.DomUtil.addClass(this._zoomOutButton,b),a._zoom===a.getMaxZoom()&&L.DomUtil.addClass(this._zoomInButton,b)}});c.myCustomControls.push(r),e(l,500)}]),digiletme.controller("PhotoCtrl",["VenuesAPI","FourSquarePhotos","$scope","$routeParams","$location","$timeout",function(a,b,c,d,e){"use strict";var f=0,g=0,h=0,i=0,j=0,k=0,l=1,m=0,n=0,o=0,p=0,q=new Image,r="#222";b.getPhotoUrlById(d.venueId,d.photoId).then(function(a){function b(a,b,c){if(s()){var d="rotateZ(0) translateX("+~~a+"px) translateY("+~~b+"px) scale("+c+")";s().style.webkitTransform=d}}function d(a,b,c){return b>a?b:a>c?c:a}c.url=a,""===c.url&&e.path(""),c.close=function(){e.path("")},c.onTapImage=function(){c.close()},c.onDragImageStart=function(a){a.gesture.preventDefault(),h=f,j=f,i=g,k=g},c.onDragImage=function(a){a.gesture.preventDefault(),window.innerWidth<q.width*l&&(j=d(h+a.gesture.deltaX,window.innerWidth-q.width-(o-q.width)*(1-l),(o-q.width)*(1-l))),window.innerHeight<q.height*l&&(k=d(i+a.gesture.deltaY,window.innerHeight-q.height-(p-q.height)*(1-l),(p-q.height)*(1-l))),b(j,k,l)},c.onDragImageEnd=function(a){a.gesture.preventDefault(),f=j,g=k},c.onTransformStart=function(a){m=o-a.gesture.center.pageX+f,n=p-a.gesture.center.pageY+g},c.onTransform=function(a){var c=l*a.gesture.scale,d=a.gesture.scale-1;b(f+m*d,g+n*d,c),a.gesture.preventDefault()},c.onTransformEnd=function(a){var c=l*a.gesture.scale,d=a.gesture.scale-1;l=c,f+=m*d,g+=n*d,b(f,g,l)},c.onMouseDown=function(a){return a.preventDefault(),!1},c.imageBgStyle={width:"100%",height:"100%",background:r+' url("img/loading.gif") no-repeat',backgroundPosition:"center center"},q.src=c.url,q.onload=function(){o=.5*q.width,p=.5*q.height,f=.5*(window.innerWidth-q.width),g=.5*(window.innerHeight-q.height),c.$apply(function(){c.imageBgStyle={cursor:"move",width:"100%",height:"100%",background:r+" no-repeat"},c.imageSrc=c.url,b(f,g,l)})};var s=function(){var a=document.querySelector("#imageView");return function(){return a?a:a=document.querySelector("#imageView")}}()})}]),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),angular.module("SmartIP",[]).factory("SmartIP",["$http","$q","$resource","$rootScope","$timeout",function(a){"use strict";var b={},c=!1;return b.getUserInfo=function(){return a.jsonp("http://smart-ip.net/geoip-json/?callback=JSON_CALLBACK").then(function(a){return a.data})},b.getUserIP=function(){return a.jsonp("http://jsonip.appspot.com/?callback=JSON_CALLBACK").then(function(a){return a.data})},b.getLocationInfoByIP=function(b){return a.jsonp("http://www.geoplugin.net/json.gp?ip="+b+"&jsoncallback=JSON_CALLBACK").then(function(a){return a.data})},b.getUserLocation=function(){return c?b.getUserInfo().then(function(a){return{lat:Number(a.latitude),lng:Number(a.longitude)}}):b.getUserIP().then(function(a){return b.getLocationInfoByIP(a.ip)}).then(function(a){return{lat:Number(a.geoplugin_latitude),lng:Number(a.geoplugin_longitude)}})},b}]),digiletme.controller("StatisticsCtrl",["VenuesAPI","$scope","$rootScope",function(a,b,c){"use strict";c.$on("changeNumOfRequest",function(a,c){b.numOfRequest=c})}]),FourSquareModule.factory("VenuesAPI",["FourSquareClient","$q","$resource","$rootScope","$timeout",function(a,b,c,d,e){"use strict";function f(){q++,d.$emit("changeNumOfRequest",q)}function g(a){return a.lat<o.sw.lat||o.ne.lat<a.lat||a.lng<o.sw.lng||o.ne.lng<a.lng}function h(a){for(var b=0,c=a.categories.length;c>b;b++)if(r.indexOf(a.categories[b])>=0)return!0;return!1}function i(a,b){var c=Object.keys(a);c.forEach(function(c){var d=a[c];n(d)&&b(d)})}function j(a){x[a.id]||(x[a.id]=a,d.$emit("showVenue",a))}function k(a){x[a.id]&&(x[a.id]=null,d.$emit("hideVenue",a))}function l(a){y[a.id]||(y[a.id]=a,d.$emit("showVenueWithoutPhoto",a))}function m(a){y[a.id]&&(y[a.id]=null,d.$emit("hideVenueWithoutPhoto",a))}function n(a){return a?g(a.location):!1}var o,p={},q=0;p.updateBounds=function(a,b){var c=2,e=2;if(o={sw:a,ne:b},u=null,b.lat-a.lat>c){var f=.5*(b.lat+a.lat);a.lat=f-.5*c,b.lat=f+.5*c}if(b.lng-a.lng>e){var g=.5*(b.lng+a.lng);a.lng=g-.5*e,b.lng=g+.5*e}d.$emit("updateBounds",o)},p.getBounds=function(){var a;return function(){if(a)return a.promise;if(a=b.defer(),o)e(function(){a.resolve(o),a=null},0);else var c=d.$on("updateBounds",function(b,d){a.resolve(d),a=null,c()});return a.promise}}();var r=["4bf58dd8d48988d1fe931735"],s={};p.getAdjacencyGraphOfVenues=function(a){return s[a]},c("https://api.foursquare.com/v2/venues/search?ll=:pos&intent=browse&limit=:limit&radius=:radius&categoryId=:categories&client_id=:clientId&client_secret=:clientSecret&v="+a.currentAPIDate,{limit:50,radius:1e5,clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET});var t=c("https://api.foursquare.com/v2/venues/search?sw=:sw&ne=:ne&intent=browse&limit=:limit&categoryId=:categories&client_id=:clientId&client_secret=:clientSecret&v="+a.currentAPIDate,{limit:50,clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET}),u=null,v={},w={},x={},y={};p.getLocalVenues=function(){return u||(u=p.getBounds().then(function(b){return f(),t.get({sw:b.sw.lat+", "+b.sw.lng,ne:b.ne.lat+", "+b.ne.lng,categories:r.join(","),clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET}).$promise})),u},p.getVenuesWithPhotos=function(){return p.getLocalVenues().then(function(a){function c(a){return function(){return z(a)}}function e(a){return function(b){return b.length>0?(v[a.id]=a,j(a),d.$emit("newVenueWithPhotos",a)):(w[a.id]=a,l(a),d.$emit("newVenueWithoutPhotos",a)),v}}var f=a.response.venues;i(x,k),i(y,m);for(var g=b.when({}),h=0,n=f.length;n>h;h++){var o=f[h];g=g.then(c(o)).then(e(o))}return g.then(function(a){return a})},function(a){switch(a.data.meta.errorType){case"geocode_too_big":break;default:console.log("need to add handler to error",a)}return[]})};var z=function(){var a={},c={};return function(d){return c[d.id]?b.when(c[d.id]):(a[d.id]||(a[d.id]=p.getPhotosByVenueId(d.id).then(function(b){return a[d.id]=null,c[d.id]=b,b})),a[d.id])}}(),A={},B=c("https://api.foursquare.com/v2/venues/:venueId?client_id=:clientId&client_secret=:clientSecret&v="+a.currentAPIDate);!function(){var b={};return function(c){return b[c]||(f(),b[c]=B.get({venueId:c,clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET}).$promise),b[c]}}();var C=c("https://api.foursquare.com/v2/venues/:venueId/photos?client_id=:clientId&client_secret=:clientSecret&v="+a.currentAPIDate);p.getPhotosByVenueId=function(){var b={};return function(c){return b[c]||(f(),b[c]=C.get({venueId:c,clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET}).$promise.then(function(a){for(var b=[],c=a.response.photos.items,d=0,e=c.length;e>d;d++){var f=c[d];b.push(f),A[f.id]=f}return b})),b[c]}}();var D=c("https://api.foursquare.com/v2/venues/:venueId/nextvenues?client_id=:clientId&client_secret=:clientSecret&v="+a.currentAPIDate);return p.getNextVenuesByVenueId=function(){function c(c,d){var e={};return function(g,i,j){return e[g]||(f(),e[g]=D.get({venueId:g,clientId:a.CLIENT_ID,clientSecret:a.CLIENT_SECRET}).$promise.then(function(a){for(var e=a.data.response.nextVenues.items,f=b.when(d),g=0,k=e.length;k>g;g++){var l=e[g];h(l)?f=f.then(function(){return d.push(l),s[c][l.id]={item:l},d}):i>0&&!s[c].neighborhood[l.id]&&(s[c].neighborhood[l.id]={item:l,depth:i},f=f.then(function(){return j(l.id,i-1,j)}))}return f})),e[g]}}var d={};return function(a){if(!d[a]){s[a]={neighborhood:{}};var b=c(a,[]);return b(a,8,b)}return d[a]}}(),p.getPhotoById=function(a){return A[a]},p}]);